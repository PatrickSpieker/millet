#!/usr/bin/env python3

import subprocess
import re
import sys

if len(sys.argv) != 1:
    print("usage: {}".format(sys.argv[0]))
    sys.exit(1)
NUM_RULES = 89
git_re = "SML Definition ([[:digit:]]*)"
py_re = re.compile(r"^SML Definition \((\d*)\)$")
path = "crates/core/src/statics"
git_grep = subprocess.run(
    ["git", "grep", "-h", "-o", git_re, "--", path],
    capture_output=True,
    encoding="ascii"
)
got = set()
for line in git_grep.stdout.splitlines():
    got.add(py_re.match(line).group(1))
need = []
for i in range(1, NUM_RULES + 1):
    if str(i) not in got:
        need.append(i)
if len(need) == 0:
    print("all rules from 1-{} referenced".format(NUM_RULES))
else:
    print("some rules not referenced: {}".format(need))
    sys.exit(1)
