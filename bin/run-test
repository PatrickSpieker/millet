#!/bin/sh

set -eu

if [ "$#" -eq 0 ]; then
  echo "usage: $0 <path>..."
  exit 1
fi

ok=true
old_pwd="$PWD"
for x in "$@"; do
  cd "$x"
  if sh -eu run.sh && diff out.txt out.tmp; then
    rm -f out.tmp
    echo "$x: ok"
  else
    cat out.tmp
    echo "$x: FAIL"
    ok=false
  fi
  cd "$old_pwd"
done

if "$ok"; then
  echo "==> all tests passed."
else
  echo "==> some tests failed."
  exit 1
fi
